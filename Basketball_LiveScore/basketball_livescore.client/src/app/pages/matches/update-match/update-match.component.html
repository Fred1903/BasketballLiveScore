<div *ngIf="matchDetails; else loading" class="game-container">
  <div id="top-of-page"></div>
  <!-- Game Info -->
  <div class="game-info">
    <div class="quarter">Quarter {{ quarter }}</div>
    <div class="timer">
      <span class="time">{{ formatTime(time) }}</span>
      <button class="btn btn-primary" (click)="toggleTimer()">
        <i class="fas" [class.fa-play]="!isRunning" [class.fa-pause]="isRunning"></i>
        {{ isRunning ? 'Pause' : 'Start' }}
      </button>
      <button class="btn btn-outline" (click)="nextQuarter()" [disabled]="isRunning">
        Next Quarter
      </button>
    </div>
  </div>

  <!-- Teams Container -->
  <div class="teams-container">
    <!-- Team 1 -->
    <div class="team-card">
      <div class="team-header">
        <div>
          <div class="team-name">{{ team1.name }}</div>
          <div class="team-timeouts">Timeouts: {{ team1.timeouts }}</div>
        </div>
        <div class="team-score">{{ team1.score }}</div>
      </div>

      <!-- On Court Players -->
      <div class="section-title">On Court</div>
      <div *ngFor="let player of getOnCourtPlayers(team1)" class="player-card">
        <div class="player-header">
          <div>
            <span class="player-name">#{{ player.number }} {{ player.name }}</span>
            <span class="player-points">({{ player.points }} pts)</span>
          </div>
          <button class="btn btn-outline" (click)="initiateSubstitution(team1, player)">
            <i class="fas fa-sync-alt"></i> Sub Out
          </button>
        </div>
        <div class="player-actions">
          <select class="points-select" [(ngModel)]="selectedPoint" (change)="handleScoreChange(team1, player, $event)">
            <option value="">Add Points</option>
            <option *ngFor="let point of basketPoints" [value]="point.id">{{ point.id }}</option>
          </select>
          <div class="foul-container">
            <select class="foul-select" [(ngModel)]="selectedFoul" (change)="handleFoul(player, $event)">
              <option value="">Add Foul</option>
              <option *ngFor="let foul of foulTypes" [value]="foul.id">{{ foul.name }}</option>
            </select>
            <div class="foul-count">
              <i class="fas fa-exclamation-triangle"></i> Foul ({{ player.fouls }})
            </div>
          </div>
        </div>
      </div>

      <!-- Bench Players -->
      <div *ngIf="!substitutionActive || activeTeam !== team1" class="section-title">Bench</div>
      <div *ngIf="!substitutionActive || activeTeam !== team1" class="bench-list">
        <div *ngFor="let player of getBenchPlayers(team1)" class="bench-player">
          <span>#{{ player.number }} {{ player.name }} ({{ player.points }} pts)</span>
        </div>
      </div>

      <!-- Substitution View -->
      <div *ngIf="substitutionActive && activeTeam === team1" class="section-title">Select Player to Sub In</div>
      <div *ngIf="substitutionActive && activeTeam === team1" class="bench-list substitution-active">
        <button *ngFor="let player of getBenchPlayers(team1)" class="bench-player-button" (click)="completeSubstitution(player)">
          #{{ player.number }} {{ player.name }} ({{ player.points }} pts)
        </button>
      </div>
      <button *ngIf="substitutionActive && activeTeam === team1" class="btn btn-outline cancel-sub" (click)="cancelSubstitution()">Cancel Substitution</button>
      <button class="timeout-button" (click)="startTimeout(team1)" [disabled]="team1.timeouts === 0 || isTimeout">Call Timeout</button>
    </div>

    <!-- Team 2 -->
    <div class="team-card">
      <div class="team-header">
        <div>
          <div class="team-name">{{ team2.name }}</div>
          <div class="team-timeouts">Timeouts: {{ team2.timeouts }}</div>
        </div>
        <div class="team-score">{{ team2.score }}</div>
      </div>

      <!-- On Court Players -->
      <div class="section-title">On Court</div>
      <div *ngFor="let player of getOnCourtPlayers(team2)" class="player-card">
        <div class="player-header">
          <div>
            <span class="player-name">#{{ player.number }} {{ player.name }}</span>
            <span class="player-points">({{ player.points }} pts)</span>
          </div>
          <button class="btn btn-outline" (click)="initiateSubstitution(team2, player)">
            <i class="fas fa-sync-alt"></i> Sub Out
          </button>
        </div>
        <div class="player-actions">
          <select class="points-select" [(ngModel)]="selectedPoint" (change)="handleScoreChange(team2, player, $event)">
            <option value="">Add Points</option>
            <option *ngFor="let point of basketPoints" [value]="point.id">{{ point.id }}</option>
          </select>
          <div class="foul-container">
            <select class="foul-select" [(ngModel)]="selectedFoul" (change)="handleFoul(player, $event)">
              <option value="">Add Foul</option>
              <option *ngFor="let foul of foulTypes" [value]="foul.id">{{ foul.name }}</option>
            </select>
            <div class="foul-count">
              <i class="fas fa-exclamation-triangle"></i> Foul ({{ player.fouls }})
            </div>
          </div>
        </div>
      </div>

      <!-- Bench Players -->
      <div *ngIf="!substitutionActive || activeTeam !== team2" class="section-title">Bench</div>
      <div *ngIf="!substitutionActive || activeTeam !== team2" class="bench-list">
        <div *ngFor="let player of getBenchPlayers(team2)" class="bench-player">
          <span>#{{ player.number }} {{ player.name }} ({{ player.points }} pts)</span>
        </div>
      </div>

      <!-- Substitution View
      <div *ngIf="substitutionActive && activeTeam === team2" class="section-title">Select Player to Sub In</div>
      <div *ngIf="substitutionActive && activeTeam === team2" class="bench-list substitution-active">
        <button *ngFor="let player of getBenchPlayers(team2)" class="bench-player-button" (click)="completeSubstitution(player)">
          #{{ player.number }} {{ player.name }} ({{ player.points }} pts)
        </button>
      </div>
      <button *ngIf="substitutionActive && activeTeam === team2" class="btn btn-outline cancel-sub" (click)="cancelSubstitution()">Cancel Substitution</button>
      <button class="timeout-button" (click)="startTimeout(team2)" [disabled]="team2.timeouts === 0 || isTimeout">Call Timeout</button>-->
      <div *ngIf="substitutionActive && activeTeam === team2">
        <div class="section-title">Select Player to Sub In</div>
        <div id="team2-bench" class="bench-list substitution-active">
          <button *ngFor="let player of getBenchPlayers(team2)"
                  class="bench-player-button"
                  (click)="completeSubstitution(player)">
            #{{ player.number }} {{ player.name }} ({{ player.points }} pts)
          </button>
        </div>
        <button class="btn btn-outline cancel-sub" (click)="cancelSubstitution()">Cancel Substitution</button>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <p>Loading match details...</p>
</ng-template>
